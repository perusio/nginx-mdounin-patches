# HG changeset patch
# User Maxim Dounin <mdounin@mdounin.ru>
# Date 1297776702 -10800
# Node ID 55b603cb18b8faf448c6ed97f6aa6062bfb7b01d
# Parent  f4064857c04edf45bc2169e8a7ae90529bb463e1
Fix connection drops with AIO.

Connections serving content with AIO to fast clients were dropped with
"client timed out" messages after send_timeout from response start.

diff --git a/src/http/ngx_http_request.c b/src/http/ngx_http_request.c
--- a/src/http/ngx_http_request.c
+++ b/src/http/ngx_http_request.c
@@ -2266,7 +2266,7 @@ ngx_http_writer(ngx_http_request_t *r)
 
     if (r->buffered || r->postponed || (r == r->main && c->buffered)) {
 
-        if (!wev->ready && !wev->delayed) {
+        if (!wev->delayed) {
             ngx_add_timer(wev, clcf->send_timeout);
         }
